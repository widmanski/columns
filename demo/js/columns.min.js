!function(a){"use strict";a.zepto&&!a.fn.removeData&&console.log("Error: Zepto is loaded without the data module."),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||!1}(),a.fn.columns=function(b){function c(b){b=b||{};var c=this,h={namespace:"columns",height:c.height(),width:c.width(),top:c.offset().top,left:c.offset().left,win:m.height(),winW:m.width(),gutterTop:0,cols:4,columnHeights:[],columnTemplate:'<div class="column">{{ content }}</div>',autoWidth:!0,createColumns:!0,proportionalScroll:!1,reverse:!1,reversedDirection:!1,requestFrame:!0},i=c.children(),k=i.length,l=0,n=[],o=0,p="";if(b.filter=b.filter||!1,a.extend(h,b),h.createColumns){for(h.oldHTML=c[0].innerHTML,l=0;k>l;l++)n[o]=(n[o]||"")+i[l].outerHTML,o++,o===h.cols&&(o=0);for(l=0;l<h.cols;l++)n[l]=n[l]||"",p+=h.columnTemplate.replace("{{ content }}",n[l]);c.html(p),h.columns=c.find(".column")}else h.columns=c.children();return c.data("settings",h),window.requestAnimationFrame&&h.requestFrame?(d(),m.on("scroll."+h.namespace,this,f).on("resize."+h.namespace,this,e).on("touchmove."+h.namespace,this,f).trigger("scroll").trigger("resize"),e(),f()):(m.on("scroll."+h.namespace,this,g).on("resize."+h.namespace,this,e).on("touchmove."+h.namespace,this,g).trigger("scroll").trigger("resize"),e(),g()),j=setTimeout(e,2e3),c}function d(){requestAnimFrame(d),g()}function e(){if(h.length){var a=h,b=a.data("settings"),c=0,d=0,e=0,g={left:0};for(b.width=a.width(),b.top=a.offset().top,b.left=a.offset().left,b.win=m.height(),b.winW=m.width(),b.autoWidth&&(g.width=b.width/b.cols+"px"),c=0;c<b.cols;c++)b.columns.eq(c).removeAttr("style").removeClass("is-fixed").removeClass("is-short"),g.marginLeft=e,b.columns.eq(c).css(g),b.columnHeights[c]=b.columns.eq(c).height()+b.gutterTop,d=Math.max(b.columnHeights[c],d),e+=b.columns.eq(c).width();a.height(d),b.height=d,a.data("settings",b),f.call(a,{data:[a]})}}function f(){l=!0,clearTimeout(k),k=setTimeout(function(){l=!1})}function g(){var a=h,b=a.data("settings"),c=i.scrollY?window.scrollY:m.scrollTop(),d=0;if(b.proportionalScroll){var e=1,f=0,g="",j=0;for(d=0;d<b.cols;d++)e=b.columnHeights[d]/b.height,1!==e&&(f=(1-e)*b.height*Math.min(1,Math.max(0,(c-b.top)/(b.height-b.win))),f=Math.round(f),g="translate3d(0px,"+f+"px, 0px)",(c-b.top)/(b.height-b.win)>1&&(g="none",j=f),b.columns.eq(d).css({transform:g,"-webkit-transform":g,"-moz-transform":g,"-ms-transform":g,top:j}))}else{if(c<b.top)return b.columns.removeClass("is-fixed").removeClass("is-top-fixed").removeClass("is-short").css({left:0,minHeight:0,top:b.gutterTop}),void a.removeClass("is-scrolled-past");if(c+b.win>b.top+b.height){for(b.columns.removeClass("is-fixed").removeClass("is-top-fixed").css({left:0,transform:"none","-webkit-transform":"none","-moz-transform":"none","-ms-transform":"none"}),d=0;d<b.cols;d++)b.columnHeights[d]<b.win&&b.columnHeights[d]<b.height&&b.columns.eq(d).css(c+b.columnHeights[d]>b.top+b.height?{top:"auto",bottom:0}:{top:c-b.top+b.gutterTop});return void a.addClass("is-scrolled-past")}if(a.removeClass("is-scrolled-past"),b.reverse)for(d=0;d<b.cols;d++)b.columnHeights[d]<b.win&&c>b.top?b.columns.eq(d).removeClass("is-bottom-fixed").addClass("is-short").css({left:b.left,top:0}):(b.columns.eq(d).removeClass("is-short").css({left:0,top:0}),c<b.top||(c>b.top+b.height-b.columnHeights[d]?b.columns.eq(d).removeClass("is-top-fixed").css({left:0,top:b.height-b.columnHeights[d]}):b.columnHeights[d]<b.height&&b.columns.eq(d).addClass("is-top-fixed").css({left:b.left})));else for(d=0;d<b.cols;d++)if(b.columnHeights[d]<b.win&&c>b.top)b.columns.eq(d).removeClass("is-fixed").addClass("is-short").css({left:b.left,transform:"none","-webkit-transform":"none","-moz-transform":"none","-ms-transform":"none",top:b.gutterTop});else if(b.columns.eq(d).removeClass("is-short").css({left:0}),!(c<b.top))if(b.reversedDirection&&d%2!==0){var f=2*Math.max(c-b.top,0)+b.win-b.columnHeights[d];f=Math.round(f),f=Math.min(f,-b.win+b.height),g="translate3d(0px,"+f+"px, 0px)",b.columns.eq(d).css({transform:g,"-webkit-transform":g,"-moz-transform":g,"-ms-transform":g})}else c>b.top+b.columnHeights[d]+b.gutterTop-b.win?b.columns.eq(d).addClass("is-fixed").css({top:"auto",left:b.left}):b.columns.eq(d).removeClass("is-fixed").css({left:0})}}var h=this,i={scrollY:window.scrollY>=0?!0:!1},j=null,k=null,l=!1,m=(a(document),a("body"),a(window)),n={destroy:function(){var b=this.data("settings");b&&(b.createColumns&&(this[0].innerHTML=b.oldHTML,this[0].setAttribute("style","")),m.off("."+b.namespace),a(this).removeData("settings"),clearTimeout(j))},update:function(b,c){var d=a(this),e=d.data("settings")||{};e[b]=c,d.data("settings",e)}};if("string"==typeof b&&b in n)return n[b].call(this,arguments.length>1?arguments.slice(1):arguments),h;return c.call(this,b)}}(window.jQuery||window.Zepto);